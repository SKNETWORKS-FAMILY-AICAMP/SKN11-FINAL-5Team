# ë§ˆì¼€íŒ… ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš° ì„¤ì •
# ì‚¬ìš©ì ì œê³µ ì›Œí¬í”Œë¡œìš° êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±

workflow:
  name: "marketing_automation_workflow"
  description: "ë§ˆì¼€íŒ… ìë™í™” MCP ì—°ë™ ì›Œí¬í”Œë¡œìš°"
  version: "1.0.0"

# 1ë‹¨ê³„: ì‚¬ìš©ì ì…ë ¥ í•´ì„
steps:
  - step: interpret-user-input
    type: llm
    client: gpt-4o
    description: "ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë¶„ì„í•´ ë§ˆì¼€íŒ… ì„¤ëª…ì„ ì •ë¦¬"
    prompt: >
      ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë¶„ì„í•´ ë§ˆì¼€íŒ… ì„¤ëª…ì„ ì •ë¦¬í•´ì¤˜.
      ë‹¤ìŒ ìš”ì†Œë“¤ì„ í¬í•¨í•´ì„œ ë¶„ì„í•´ì¤˜:
      - ì œí’ˆ/ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ê°€ì¹˜
      - íƒ€ê²Ÿ ê³ ê°ì¸µ
      - ì°¨ë³„í™” í¬ì¸íŠ¸
      - ë§ˆì¼€íŒ… ë©”ì‹œì§€ ë°©í–¥ì„±
    input_schema:
      type: object
      properties:
        user_request:
          type: string
          description: "ì‚¬ìš©ìì˜ ë§ˆì¼€íŒ… ìš”ì²­"
      required: ["user_request"]

  # 2ë‹¨ê³„: í”Œë«í¼ ì„ íƒ
  - step: select-platform
    type: memory
    description: "ë§ˆì¼€íŒ…í•  í”Œë«í¼ ì„ íƒ"
    prompt: >
      ì–´ë–¤ í”Œë«í¼ì— ë§ˆì¼€íŒ…í• ê¹Œìš”? (instagram / naver-blog)
      
      Instagram:
      - ì‹œê°ì  ì½˜í…ì¸  ì¤‘ì‹¬
      - ì Šì€ ì¸µ íƒ€ê²Ÿì— íš¨ê³¼ì 
      - í•´ì‹œíƒœê·¸ ë§ˆì¼€íŒ… í™œìš©
      
      Naver Blog:
      - ê²€ìƒ‰ ìµœì í™” íš¨ê³¼ì 
      - ìƒì„¸í•œ ì •ë³´ ì „ë‹¬ ê°€ëŠ¥
      - êµ­ë‚´ ê²€ìƒ‰ íŠ¸ë˜í”½ ë†’ìŒ
    options:
      - value: "instagram"
        label: "Instagram ğŸ“¸"
        description: "ì‹œê°ì  ë§ˆì¼€íŒ…, í•´ì‹œíƒœê·¸ í™œìš©"
      - value: "naver-blog" 
        label: "Naver Blog ğŸ“"
        description: "ê²€ìƒ‰ ìµœì í™”, ìƒì„¸ ì •ë³´ ì „ë‹¬"

  # 3ë‹¨ê³„: í”Œë«í¼ë³„ ë§ˆì¼€íŒ… ë¬¸ë§¥ ìƒì„±
  - step: get-marketing-context
    type: branch
    description: "ì„ íƒëœ í”Œë«í¼ì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬"
    branches:
      # Instagram ë¶„ê¸°
      - when: "select-platform.output == 'instagram'"
        steps:
          - step: get-instagram-hashtags
            server: "@smithery-ai/hashtag-generator"
            tool: "generate_hashtags"
            description: "ì¸ìŠ¤íƒ€ê·¸ë¨ìš© í•´ì‹œíƒœê·¸ ìƒì„±"
            input:
              query: "@interpret-user-input.output"
            
          - step: merge-instagram-context
            type: transform
            description: "í•´ì„ëœ ìš”ì²­ê³¼ í•´ì‹œíƒœê·¸ ë³‘í•©"
            input: >
              {{
                interpret-user-input.output + "\n\n[ì¶”ì²œ í•´ì‹œíƒœê·¸]\n" + get-instagram-hashtags.output
              }}

      # Naver Blog ë¶„ê¸°  
      - when: "select-platform.output == 'naver-blog'"
        steps:
          - step: get-naver-keywords
            server: "@smithery-ai/naver-search-mcp" 
            tool: "get_related_keywords"
            description: "ë„¤ì´ë²„ ì—°ê´€ í‚¤ì›Œë“œ ê²€ìƒ‰"
            input:
              query: "@interpret-user-input.output"
            
          - step: merge-blog-context
            type: transform
            description: "í•´ì„ëœ ìš”ì²­ê³¼ ì—°ê´€ í‚¤ì›Œë“œ ë³‘í•©"
            input: >
              {{
                interpret-user-input.output + "\n\n[ì—°ê´€ í‚¤ì›Œë“œ]\n" + get-naver-keywords.output
              }}

  # 4ë‹¨ê³„: ì½˜í…ì¸  ìƒì„± (ê³µí†µ)
  - step: generate-marketing
    server: "@synthetic-ci/vibe-marketing"
    tool: "find-hooks"
    description: "ë§¤ë ¥ì ì¸ ë§ˆì¼€íŒ… ì½˜í…ì¸  ìƒì„±"
    input:
      platform: "@select-platform.output"
      category: "promotional"
      context: >-
        {{
          merge-instagram-context.output or merge-blog-context.output
        }}
      limit: 2

  # 5ë‹¨ê³„: í›„ì²˜ë¦¬
  - step: finalize
    type: branch
    description: "í”Œë«í¼ë³„ ìµœì¢… ì²˜ë¦¬"
    branches:
      # Instagram í›„ì²˜ë¦¬
      - when: "select-platform.output == 'instagram'"
        steps:
          - step: post-to-instagram
            server: "@midwest/meta-post-scheduler-mcp"
            tool: "schedule_post"
            description: "ì¸ìŠ¤íƒ€ê·¸ë¨ ìë™ í¬ìŠ¤íŒ…"
            input:
              url: "https://your-agent.com/instagram"
              method: "POST"
              body: "@generate-marketing.output"
              schedule_time: "optional"

      # Naver Blog í›„ì²˜ë¦¬
      - when: "select-platform.output == 'naver-blog'"
        steps:
          - step: prepare-blog-html
            type: transform
            description: "ë¸”ë¡œê·¸ìš© HTML ë³€í™˜"
            input: >
              {{
                "<h2>ğŸ“£ ë¸”ë¡œê·¸ ì œëª© ì˜ˆì‹œ</h2>\n" +
                "<p>" + generate-marketing.output + "</p>\n\n" +
                "<p><strong>#AI #ì‹¤ì‹œê°„ë²ˆì—­ê¸° #ì—¬í–‰í•„ìˆ˜í…œ</strong></p>"
              }}
              
          - step: show-blog-draft
            type: say
            description: "ì‚¬ìš©ìì—ê²Œ ë¸”ë¡œê·¸ ì´ˆì•ˆ ì œê³µ"
            input: >
              ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë„¤ì´ë²„ ë¸”ë¡œê·¸ì— ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš” âœï¸  
              ---  
              {{ prepare-blog-html.output }}

# MCP ì„œë²„ ì„¤ì •
mcp_servers:
  hashtag_generator:
    url: "https://smithery.ai/server/@HeurisTech/product-trends-mcp"
    tools:
      - "insta_hashtag_scraper"
    
  naver_search:
    url: "https://smithery.ai/server/@isnow890/naver-search-mcp"
    tools:
      - "get_related_keywords"
      - "search_trend"
    
  vibe_marketing:
    url: "https://smithery.ai/server/@synthetic-ci/vibe-marketing"
    tools:
      - "find-hooks"
      - "generate_content"
      - "get-network-categories-for-hooks"
      - "list-copywriting-frameworks"
      - "get-copywriting-framework"
      - "get-trending-content"
    
  meta_scheduler:
    url: "https://smithery.ai/server/@midwest/meta-post-scheduler-mcp"
    tools:
      - "schedule_post"
      - "post_now"

# í”Œë«í¼ë³„ ìµœì í™” ì„¤ì •
platform_configs:
  instagram:
    content_types:
      - "feed_post"
      - "story"
      - "reel"
      - "igtv"
    hashtag_limit: 30
    character_limit: 2200
    optimal_posting_times:
      weekdays: ["08:00-09:00", "12:00-13:00", "19:00-21:00"]
      weekends: ["10:00-11:00", "14:00-15:00", "20:00-22:00"]
    content_guidelines:
      - "ì‹œê°ì  ì„íŒ©íŠ¸ ì¤‘ìš”"
      - "ì²« ë¬¸ì¥ì— í›… í¬í•¨"
      - "ìŠ¤í† ë¦¬í…”ë§ í™œìš©"
      - "CTA ëª…í™•íˆ ì œì‹œ"

  naver_blog:
    content_types:
      - "review"
      - "information"
      - "tutorial"
      - "experience"
    keyword_density: "2-3%"
    min_content_length: 1000
    seo_requirements:
      - "ì œëª©ì— í‚¤ì›Œë“œ í¬í•¨"
      - "ì†Œì œëª© í™œìš©"
      - "ì´ë¯¸ì§€ ALT í…ìŠ¤íŠ¸"
      - "ë‚´ë¶€ ë§í¬ ì—°ê²°"
    content_guidelines:
      - "ìƒì„¸í•œ ì •ë³´ ì œê³µ"
      - "ë‹¨ê³„ë³„ ì„¤ëª…"
      - "ì‹¤ì œ ê²½í—˜ë‹´ í¬í•¨"
      - "ê²€ìƒ‰ í‚¤ì›Œë“œ ìì—°ìŠ¤ëŸ½ê²Œ ë°°ì¹˜"

# ì„±ê³¼ ì¸¡ì • ì„¤ì •
analytics:
  instagram:
    metrics:
      - "reach"
      - "impressions" 
      - "engagement_rate"
      - "profile_visits"
      - "website_clicks"
    reporting_schedule: "daily"
    
  naver_blog:
    metrics:
      - "page_views"
      - "search_impressions"
      - "click_through_rate"
      - "average_time_on_page"
      - "bounce_rate"
    reporting_schedule: "weekly"

# ìë™í™” ê·œì¹™
automation_rules:
  content_generation:
    frequency: "on_demand"
    quality_check: true
    approval_required: false
    
  posting_schedule:
    auto_schedule: true
    optimal_timing: true
    timezone: "Asia/Seoul"
    
  performance_optimization:
    auto_adjust: true
    a_b_testing: true
    feedback_integration: true

# ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬
error_handling:
  retry_attempts: 3
  fallback_strategies:
    - "use_cached_content"
    - "manual_intervention"
    - "simplified_workflow"
  
  notifications:
    channels: ["email", "slack"]
    escalation_levels: ["warning", "error", "critical"]

# ë³´ì•ˆ ë° ì¸ì¦
security:
  api_keys:
    storage: "environment_variables"
    rotation_schedule: "monthly"
  
  access_control:
    role_based: true
    audit_logging: true
  
  data_privacy:
    user_data_retention: "30_days"
    anonymization: true
